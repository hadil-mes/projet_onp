{% extends "base.html" %}
{% block content %}
<h2>DÃ©tail du lot</h2>

<p><strong>EspÃ¨ce :</strong> {{ lot.espece }}</p>
<p><strong>Poids :</strong> {{ lot.poids }} kg</p>
<p><strong>Origine :</strong> {{ lot.origine }}</p>
<p><strong>Prix de base :</strong> {{ lot.prix_base }} DH</p>
<p><strong>Prix actuel :</strong> {{ lot.prix_actuel }} DH</p>

<p><strong>Vendeur :</strong> {{ lot.vendeur.nom }}</p>
<p><strong>Statut :</strong> {{ statut }}</p>

{% if gagnant %}
    <p><strong>ğŸ† Gagnant :</strong> {{ gagnant }}</p>
{% endif %}

<hr>

<h4>Participer Ã  lâ€™enchÃ¨re</h4>
{% if current_user.is_authenticated %}
    {% if current_user.id == lot.vendeur_id %}
        <p style="color:red;">ğŸ”’ Vous Ãªtes le vendeur de ce lot. Vous ne pouvez pas enchÃ©rir.</p>
    {% elif lot.est_termine() %}
        <p style="color:gray;">â³ Cette enchÃ¨re est terminÃ©e.</p>
    {% else %}
        <form action="{{ url_for('encherir', lot_id=lot.id) }}" method="POST">
            <input type="number" name="montant" placeholder="Votre offre" required>
            <button type="submit">ğŸ’° EnchÃ©rir</button>
        </form>
    {% endif %}
{% else %}
    <p><a href="{{ url_for('login') }}">ğŸ”‘ Connectez-vous</a> pour enchÃ©rir.</p>
{% endif %}

<hr>

<h3>Historique des enchÃ¨res</h3>
{% if encheres %}
<table>
    <tr>
        <th>Montant</th>
        <th>Acheteur</th>
        <th>Date</th>
    </tr>
    {% for e in encheres %}
    <tr>
        <td>{{ e.montant }} DH</td>
        <td>
            {% if loop.first %}
                {{ e.acheteur.nom }}   {# ğŸ‘‰ seul le dernier enchÃ©risseur rÃ©vÃ©lÃ© #}
            {% else %}
                Anonyme
            {% endif %}
        </td>
        <td>{{ e.date.strftime("%Y-%m-%d %H:%M:%S") }}</td>
    </tr>
    {% endfor %}
</table>
{% else %}
<p>Aucune enchÃ¨re encore pour ce lot.</p>
{% endif %}
{% if statut == "En cours" %}
    <span style="background:green;color:white;padding:4px 8px;border-radius:5px;">ğŸŸ¢ En cours</span>
{% else %}
    <span style="background:red;color:white;padding:4px 8px;border-radius:5px;">ğŸ”´ TerminÃ©</span>
{% endif %}

<a href="{{ url_for('encheres') }}">â¬… Retour Ã  la liste des enchÃ¨res</a>
{% endblock %}

